# 猫咪追踪Web应用 - 浏览器视频流版本

## ✨ 新功能

现在可以**直接在浏览器中查看实时视频流**，无需打开额外的OpenCV窗口！

## 🚀 快速开始

### 1. 停止当前服务器（如果正在运行）
在终端按 `Ctrl+C` 停止当前运行的服务器。

### 2. 重新启动服务器
```bash
python web_app.py
```

### 3. 打开浏览器
访问 `http://localhost:5000`

## 📺 使用步骤

### 步骤1: 启动相机
- 点击视频区域的"启动相机"按钮
- 等待RealSense相机初始化
- 看到实时视频流后进入下一步

### 步骤2: 上传参考照片
- 上传一张清晰的目标猫照片
- 点击"上传照片"按钮

### 步骤3: 启动追踪
- 点击"启动追踪"按钮
- 在浏览器的视频流中实时查看追踪结果

### 步骤4: 查看结果
- 🟢 **绿色框** = 目标猫（显示距离和相似度）
- ⚪ **灰色框** = 其他猫
- 右上角显示实时FPS

## 🎯 功能特点

✅ **浏览器内视频流** - 无需额外窗口  
✅ **实时追踪显示** - 直接在网页中查看  
✅ **距离测量** - 使用RealSense深度信息  
✅ **相似度评分** - ResNet50特征匹配  
✅ **多猫识别** - 同时检测多只猫  
✅ **响应式设计** - 支持不同屏幕尺寸  

## 🎨 界面说明

### 视频流区域
- 显示RealSense相机的实时画面
- 追踪时自动绘制检测框和标签
- 显示目标猫的距离和相似度分数

### 状态指示器
- 🟢 绿点 = 追踪中
- 🔵 灰点 = 就绪

### 控制按钮
- **启动相机**: 开启视频流
- **上传照片**: 选择参考猫照片
- **启动追踪**: 开始识别目标猫
- **停止追踪**: 停止识别

## ⚙️ 技术架构

### 后端
- Flask Web框架
- MJPEG视频流
- 多线程处理
- RealSense Pipeline管理

### 前端
- HTML5 `<img>` 标签显示MJPEG流
- JavaScript异步控制
- 实时状态轮询

### AI处理
- YOLOv8n: 猫检测 (每2帧)
- ResNet50: 特征提取
- 余弦相似度: 匹配算法

## 🔧 API端点

| 端点 | 方法 | 功能 |
|------|------|------|
| `/` | GET | 主页 |
| `/video_feed` | GET | MJPEG视频流 |
| `/upload` | POST | 上传照片 |
| `/start_camera` | POST | 启动相机 |
| `/stop_camera` | POST | 停止相机 |
| `/start_tracking` | POST | 启动追踪 |
| `/stop_tracking` | POST | 停止追踪 |
| `/status` | GET | 获取状态 |

## 📊 性能优化

- ✅ 每2帧处理一次（减少CPU负载）
- ✅ JPEG质量设置为85（平衡质量和速度）
- ✅ 30FPS视频流
- ✅ 异步帧生成器
- ✅ 线程锁保护帧数据

## ⚠️ 注意事项

1. **相机连接**: 确保RealSense相机已正确连接
2. **浏览器兼容**: 推荐使用Chrome、Firefox或Edge
3. **网络延迟**: 本地访问延迟最低
4. **同时访问**: 多个浏览器可同时查看视频流
5. **资源占用**: 追踪时会占用较多CPU

## 🐛 故障排除

### 问题1: 视频流无法显示
**解决方案:**
- 检查RealSense相机连接
- 点击"启动相机"按钮
- 查看终端错误信息
- 刷新浏览器页面

### 问题2: 追踪不工作
**解决方案:**
- 确保已上传参考照片
- 确保相机已启动
- 检查是否有猫在视野内
- 尝试使用更清晰的参考照片

### 问题3: 视频卡顿
**解决方案:**
- 关闭其他占用资源的程序
- 降低浏览器缩放比例
- 确保使用的是本地网络

### 问题4: "相机初始化失败"
**解决方案:**
```bash
# 检查RealSense设备
rs-enumerate-devices

# 重新插拔相机
# 然后重启应用
```

## 🌐 局域网访问

如果需要从其他设备访问：

1. 找到服务器IP地址：
```bash
hostname -I
```

2. 在其他设备浏览器访问：
```
http://你的IP:5000
```

例如: `http://192.168.1.100:5000`

## 🔐 安全提示

⚠️ **这是开发服务器，不要在生产环境使用**

如需生产部署，使用Gunicorn或uWSGI：
```bash
pip install gunicorn
gunicorn -w 1 -b 0.0.0.0:5000 web_app:app
```

注意：由于视频流的特殊性，只能使用1个worker进程。

## 📈 系统要求

- **Python**: 3.8+
- **RAM**: 至少4GB（推荐8GB）
- **CPU**: 支持AVX指令集
- **GPU**: 可选（CUDA加速）
- **相机**: Intel RealSense D400系列

## 🎓 了解更多

- [RealSense SDK文档](https://github.com/IntelRealSense/librealsense)
- [YOLOv8文档](https://docs.ultralytics.com/)
- [Flask流式传输](https://flask.palletsprojects.com/en/2.3.x/patterns/streaming/)

## 💡 提示

- 使用清晰、光线充足的参考照片
- 相机应正对猫的活动区域
- 背景简单有助于提高识别准确度
- 定期清洁RealSense镜头

## 🆘 获取帮助

如遇问题，请检查：
1. 终端输出的错误信息
2. 浏览器控制台（F12）
3. RealSense Viewer是否能看到画面
4. requirements.txt中的依赖是否完整安装

---

**享受你的猫咪追踪体验！** 🐱✨
